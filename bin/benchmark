#!/usr/bin/env bash

set -euxo pipefail

rm -rf benchmark
mkdir benchmark

cd benchmark

for HEIGHT_LIMIT in 100 250 500 1000 2000; do
  /usr/bin/time -o $HEIGHT_LIMIT.time sudo \
    CARGO_PROFILE_RELEASE_DEBUG=true \
    RUST_LOG=info \
    cargo flamegraph \
    --deterministic \
    --bin ord \
    --output $HEIGHT_LIMIT.svg \
    -- \
    --chain signet \
    --data-dir . \
    --height-limit $HEIGHT_LIMIT \
    index
  sudo chown -n $UID $HEIGHT_LIMIT.svg
  sudo chown -n $UID index.redb
  mv index.redb $HEIGHT_LIMIT.redb
done
